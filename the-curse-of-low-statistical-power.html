<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>The curse of low statistical power - Johan Carlin</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://www.johancarlin.com/the-curse-of-low-statistical-power.html">

        <meta name="author" content="Johan Carlin" />
        <meta name="keywords" content="scientific computing,python,power,statistics" />
        <meta name="description" content="How selection bias perpetuates low power in science" />

        <meta property="og:site_name" content="Johan Carlin" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="The curse of low statistical power"/>
        <meta property="og:url" content="https://www.johancarlin.com/the-curse-of-low-statistical-power.html"/>
        <meta property="og:description" content="How selection bias perpetuates low power in science"/>
        <meta property="article:published_time" content="2020-06-10" />
            <meta property="article:section" content="blog" />
            <meta property="article:tag" content="scientific computing" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="power" />
            <meta property="article:tag" content="statistics" />
            <meta property="article:author" content="Johan Carlin" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.johancarlin.com/theme/css/bootstrap.lumen.min.css" type="text/css"/>
    <link href="https://www.johancarlin.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.johancarlin.com/theme/css/pygments/solarized-light.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.johancarlin.com/theme/css/style.css" type="text/css"/>
        <link href="https://www.johancarlin.com/custom.css" rel="stylesheet">

        <link href="https://www.johancarlin.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Johan Carlin ATOM Feed"/>

        <link href="https://www.johancarlin.com/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate"
              title="Johan Carlin blog ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.johancarlin.com/" class="navbar-brand">
Johan Carlin            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="https://www.johancarlin.com/category/blog.html">Blog</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.johancarlin.com/the-curse-of-low-statistical-power.html"
                       rel="bookmark"
                       title="Permalink to The curse of low statistical power">
                        The curse of low statistical power
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2020-06-10T00:00:00+01:00"> 10 June 2020</time>
    </span>
          <span class="label label-default">Modified</span>
            <span class="modified">
                <i class="fa fa-calendar"></i><time datetime="2020-06-10T00:00:00+01:00"> 10 June 2020</time>
            </span>


            <span class="label label-default">By</span>
            <a href="https://www.johancarlin.com/author/johan-carlin.html"><i class="fa fa-user"></i> Johan Carlin</a>



<span class="label label-default">Tags</span>
	<a href="https://www.johancarlin.com/tag/scientific-computing.html">scientific computing</a>
        /
	<a href="https://www.johancarlin.com/tag/python.html">python</a>
        /
	<a href="https://www.johancarlin.com/tag/power.html">power</a>
        /
	<a href="https://www.johancarlin.com/tag/statistics.html">statistics</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <style type="text/css">/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI escape sequences */
/* The color values are a mix of
   http://www.xcolors.net/dl/baskerville-ivorylight and
   http://www.xcolors.net/dl/euphrasia */
.ansi-black-fg {
  color: #3E424D;
}
.ansi-black-bg {
  background-color: #3E424D;
}
.ansi-black-intense-fg {
  color: #282C36;
}
.ansi-black-intense-bg {
  background-color: #282C36;
}
.ansi-red-fg {
  color: #E75C58;
}
.ansi-red-bg {
  background-color: #E75C58;
}
.ansi-red-intense-fg {
  color: #B22B31;
}
.ansi-red-intense-bg {
  background-color: #B22B31;
}
.ansi-green-fg {
  color: #00A250;
}
.ansi-green-bg {
  background-color: #00A250;
}
.ansi-green-intense-fg {
  color: #007427;
}
.ansi-green-intense-bg {
  background-color: #007427;
}
.ansi-yellow-fg {
  color: #DDB62B;
}
.ansi-yellow-bg {
  background-color: #DDB62B;
}
.ansi-yellow-intense-fg {
  color: #B27D12;
}
.ansi-yellow-intense-bg {
  background-color: #B27D12;
}
.ansi-blue-fg {
  color: #208FFB;
}
.ansi-blue-bg {
  background-color: #208FFB;
}
.ansi-blue-intense-fg {
  color: #0065CA;
}
.ansi-blue-intense-bg {
  background-color: #0065CA;
}
.ansi-magenta-fg {
  color: #D160C4;
}
.ansi-magenta-bg {
  background-color: #D160C4;
}
.ansi-magenta-intense-fg {
  color: #A03196;
}
.ansi-magenta-intense-bg {
  background-color: #A03196;
}
.ansi-cyan-fg {
  color: #60C6C8;
}
.ansi-cyan-bg {
  background-color: #60C6C8;
}
.ansi-cyan-intense-fg {
  color: #258F8F;
}
.ansi-cyan-intense-bg {
  background-color: #258F8F;
}
.ansi-white-fg {
  color: #C5C1B4;
}
.ansi-white-bg {
  background-color: #C5C1B4;
}
.ansi-white-intense-fg {
  color: #A1A6B2;
}
.ansi-white-intense-bg {
  background-color: #A1A6B2;
}
.ansi-default-inverse-fg {
  color: #FFFFFF;
}
.ansi-default-inverse-bg {
  background-color: #000000;
}
.ansi-bold {
  font-weight: bold;
}
.ansi-underline {
  text-decoration: underline;
}
/* The following styles are deprecated an will be removed in a future version */
.ansibold {
  font-weight: bold;
}
.ansi-inverse {
  outline: 0.5px dotted;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  position: relative;
  overflow: visible;
}
div.cell:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: transparent;
}
div.cell.jupyter-soft-selected {
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected,
div.cell.selected.jupyter-soft-selected {
  border-color: #ababab;
}
div.cell.selected:before,
div.cell.selected.jupyter-soft-selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #42A5F5;
}
@media print {
  div.cell.selected,
  div.cell.selected.jupyter-soft-selected {
    border-color: transparent;
  }
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
}
.edit_mode div.cell.selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #66BB6A;
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  /* Note that this should set vertical padding only, since CodeMirror assumes
       that horizontal padding will be set on CodeMirror pre */
  padding: 0.4em 0;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. This sets horizontal padding only,
    use .CodeMirror-lines for vertical */
  padding: 0 0.4em;
  border: 0;
  border-radius: 0;
}
.CodeMirror-cursor {
  border-left: 1.4px solid black;
}
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .CodeMirror-cursor {
    border-left: 2px solid black;
  }
}
@media screen and (min-width: 4320px) {
  .CodeMirror-cursor {
    border-left: 4px solid black;
  }
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
div.output_area .mglyph > img {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 1px 0 1px 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}
.rendered_html ul:not(.list-inline),
.rendered_html ol:not(.list-inline) {
  padding-left: 2em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}





.rendered_html pre,




.rendered_html tr,
.rendered_html th,


.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,


.rendered_html * + .alert {
  margin-top: 1em;
}
[dir="rtl"] 
div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.rendered .rendered_html tr,
.text_cell.rendered .rendered_html th,
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.text_cell .dropzone .input_area {
  border: 2px dashed #bababa;
  margin: -1px;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
</style>
<style type="text/css"> .highlight pre  .hll { background-color: #ffffcc }
 .highlight pre   { background: #f8f8f8; }
 .highlight pre  .c { color: #408080; font-style: italic } /* Comment */
 .highlight pre  .err { border: 1px solid #FF0000 } /* Error */
 .highlight pre  .k { color: #008000; font-weight: bold } /* Keyword */
 .highlight pre  .o { color: #666666 } /* Operator */
 .highlight pre  .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
 .highlight pre  .cm { color: #408080; font-style: italic } /* Comment.Multiline */
 .highlight pre  .cp { color: #BC7A00 } /* Comment.Preproc */
 .highlight pre  .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
 .highlight pre  .c1 { color: #408080; font-style: italic } /* Comment.Single */
 .highlight pre  .cs { color: #408080; font-style: italic } /* Comment.Special */
 .highlight pre  .gd { color: #A00000 } /* Generic.Deleted */
 .highlight pre  .ge { font-style: italic } /* Generic.Emph */
 .highlight pre  .gr { color: #FF0000 } /* Generic.Error */
 .highlight pre  .gh { color: #000080; font-weight: bold } /* Generic.Heading */
 .highlight pre  .gi { color: #00A000 } /* Generic.Inserted */
 .highlight pre  .go { color: #888888 } /* Generic.Output */
 .highlight pre  .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
 .highlight pre  .gs { font-weight: bold } /* Generic.Strong */
 .highlight pre  .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
 .highlight pre  .gt { color: #0044DD } /* Generic.Traceback */
 .highlight pre  .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
 .highlight pre  .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
 .highlight pre  .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
 .highlight pre  .kp { color: #008000 } /* Keyword.Pseudo */
 .highlight pre  .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
 .highlight pre  .kt { color: #B00040 } /* Keyword.Type */
 .highlight pre  .m { color: #666666 } /* Literal.Number */
 .highlight pre  .s { color: #BA2121 } /* Literal.String */
 .highlight pre  .na { color: #7D9029 } /* Name.Attribute */
 .highlight pre  .nb { color: #008000 } /* Name.Builtin */
 .highlight pre  .nc { color: #0000FF; font-weight: bold } /* Name.Class */
 .highlight pre  .no { color: #880000 } /* Name.Constant */
 .highlight pre  .nd { color: #AA22FF } /* Name.Decorator */
 .highlight pre  .ni { color: #999999; font-weight: bold } /* Name.Entity */
 .highlight pre  .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
 .highlight pre  .nf { color: #0000FF } /* Name.Function */
 .highlight pre  .nl { color: #A0A000 } /* Name.Label */
 .highlight pre  .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
 .highlight pre  .nt { color: #008000; font-weight: bold } /* Name.Tag */
 .highlight pre  .nv { color: #19177C } /* Name.Variable */
 .highlight pre  .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
 .highlight pre  .w { color: #bbbbbb } /* Text.Whitespace */
 .highlight pre  .mb { color: #666666 } /* Literal.Number.Bin */
 .highlight pre  .mf { color: #666666 } /* Literal.Number.Float */
 .highlight pre  .mh { color: #666666 } /* Literal.Number.Hex */
 .highlight pre  .mi { color: #666666 } /* Literal.Number.Integer */
 .highlight pre  .mo { color: #666666 } /* Literal.Number.Oct */
 .highlight pre  .sa { color: #BA2121 } /* Literal.String.Affix */
 .highlight pre  .sb { color: #BA2121 } /* Literal.String.Backtick */
 .highlight pre  .sc { color: #BA2121 } /* Literal.String.Char */
 .highlight pre  .dl { color: #BA2121 } /* Literal.String.Delimiter */
 .highlight pre  .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
 .highlight pre  .s2 { color: #BA2121 } /* Literal.String.Double */
 .highlight pre  .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
 .highlight pre  .sh { color: #BA2121 } /* Literal.String.Heredoc */
 .highlight pre  .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
 .highlight pre  .sx { color: #008000 } /* Literal.String.Other */
 .highlight pre  .sr { color: #BB6688 } /* Literal.String.Regex */
 .highlight pre  .s1 { color: #BA2121 } /* Literal.String.Single */
 .highlight pre  .ss { color: #19177C } /* Literal.String.Symbol */
 .highlight pre  .bp { color: #008000 } /* Name.Builtin.Pseudo */
 .highlight pre  .fm { color: #0000FF } /* Name.Function.Magic */
 .highlight pre  .vc { color: #19177C } /* Name.Variable.Class */
 .highlight pre  .vg { color: #19177C } /* Name.Variable.Global */
 .highlight pre  .vi { color: #19177C } /* Name.Variable.Instance */
 .highlight pre  .vm { color: #19177C } /* Name.Variable.Magic */
 .highlight pre  .il { color: #666666 } /* Literal.Number.Integer.Long */</style><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The big chicken-and-egg problem in power analysis is effect size. To calculate the required sample size for a new experiment, we need an estimate of standardized effect size. But it seems unlikely that the experiment would be interesting to us if we already knew that much. The accepted solution is to find a paper that reports something comparable, and base our sample size calculations on these reported effects. In this notebook I demonstrate that that can be a <em>horrible</em> idea.</p>
<p>Before we begin it might be worth checking that you are up to speed on the materials <a href="https://www.johancarlin.com/power-prevalence-and-the-positive-predictive-value.html">from my last power notebook</a>, where we covered how reproducibility is influenced by statistical power $1-\beta$ and the adopted significance threshold $\alpha$.</p>
<p>If you want to run this notebook yourself, <a href="https://github.com/jooh/jooh.github.io/blob/source/content/blog/power_2.ipynb">the ipynb file is here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">statsmodels.stats.power</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="c1"># render as svg to avoid embedding full data</span>
<span class="c1"># (standard vega-lite behavior)</span>
<span class="n">alt</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;altair_saver&#39;</span><span class="p">,</span> <span class="n">fmts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;svg&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>

<span class="c1"># this class from statsmodels is useful</span>
<span class="n">ttest_paired</span> <span class="o">=</span> <span class="n">statsmodels</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">TTestPower</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preliminaries:-Standardized-effect-size-metrics">Preliminaries: Standardized effect size metrics<a class="anchor-link" href="#Preliminaries:-Standardized-effect-size-metrics">&#182;</a></h2><p>For parametric statistics applied to continuous data (that is, comparing means), the relevant effect sizes we need for power calculations are standardized mean differences (Cohen's $d$), or measures of association strength (typically partial eta-squared, $\eta_p^2$). The latter group is mainly relevant for ANOVA and regression-based designs where your comparisons involve more than two means, and we will not discuss them further in this notebook.</p>
<p>There are <em>many</em> flavours of $d$, which fall into two broad categories for between-subjects unpaired (Cohen's $d_s$) and within-subjects paired (Cohen's $d_z$) $T$ test designs. Within each category there are further variants that differ in how the standard deviation is estimated. Fortunately, most of this complexity arises when combining evidence over experiments in a meta analysis rather than when performing sample size calculations, so we can safely ignore the issue here (<a href="https://doi.org/10.3389/fpsyg.2013.00863">Lakens, 2013</a> is an accessible review, see also <a href="http://jakewestfall.org/blog/index.php/2016/03/25/five-different-cohens-d-statistics-for-within-subject-designs/">this blog by Jake Westfall</a>). But it's worth remembering this complexity when $d$ is reported in papers - the reported $d$ may not be what you need for power analysis.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Power-for-paired-$T$-designs:-Cohen's-$d_z$">Power for paired $T$ designs: Cohen's $d_z$<a class="anchor-link" href="#Power-for-paired-$T$-designs:-Cohen's-$d_z$">&#182;</a></h3><p>For a paired $T$ test (or equivalently, a one-sample $T$), we obtain $d_z$ by simply taking the mean difference divided by the sample standard deviation of the difference scores. There is also a handy conversion from $T$ to $d$:</p>
$$d_z = T / \sqrt{N}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="What's-a-typical-$d_z$-in-my-research?">What's a typical $d_z$ in my research?<a class="anchor-link" href="#What's-a-typical-$d_z$-in-my-research?">&#182;</a></h3><p>Hard to say! It's kind of the point of this notebook to demonstrate how hard it is to get a good estimate for this. The best answer probably comes from large consortium studies with open code and data. My favourite example from cognitive neuroscience is in <a href="https://doi.org/10.1038/nrn.2016.167">Poldrack et al. (2017)</a>,  Box 2. The analysis is by Joke Durnez (<a href="https://github.com/poldracklab/ScanningTheHorizon/tree/master/Box2_EffectSize">code here</a>) and reports fMRI data from the <a href="https://en.wikipedia.org/wiki/Human_Connectome_Project">Human Connectome Project</a> dataset ($N=186$):
<img src="images/Poldrack_Scanning_2017.png" alt="Poldrack et al., 2017"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The brain regions on the vertical axis are selected independently with <a href="https://neurosynth.org/">Neurosynth</a>, and the histograms for $d$ in the right panel show the distribution of effect size over voxels for particular contrasts. The authors don't describe the $d$ variant they are reporting unambiguously, but the open <a href="https://github.com/poldracklab/ScanningTheHorizon/blob/98d4fc12cdadc4bdc53f86a9e843e8b36fbda29a/Box2_EffectSize/EffectSize/EffectSize.py#L36">analysis code</a> shows that it is $d_z$, converted from a T statistic as in the formula above. Which is the variant we need for sample size calculations.</p>
<p>The median estimates are at about $d_z=0.5$ (black dots). So let's start with that in our simulations below. In the following we will assume a sample size of $N=20$, which is fairly typical for the field (see Fig 1 in Poldrack et al., 2017).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># sample size and population effect size</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">d_pop</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">alternative</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">power</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">achieved_power</span> <span class="o">=</span> <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
    <span class="n">effect_size</span><span class="o">=</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;power (d_z=</span><span class="si">{</span><span class="n">d_pop</span><span class="si">}</span><span class="s2">, N=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">alternative</span><span class="si">}</span><span class="s2">): </span><span class="se">\</span>
<span class="s2">    </span><span class="si">{</span><span class="n">achieved_power</span><span class="si">:</span><span class="s2">.2</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="c1"># how many samples would we need to achieve 80% power?</span>
<span class="n">n_for_80</span> <span class="o">=</span> <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
    <span class="n">effect_size</span><span class="o">=</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;required N (power=</span><span class="si">{</span><span class="n">power</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_for_80</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>power (d_z=0.5, N=20, alpha=0.05, two-sided):     0.56
required N (power=80%): 34
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We don't quite achieve the benchmark 80% power with this sample size - we would need 34 subjects for that. Which is also typical for the field - low power is a common problem in neuroscience (<a href="https://doi.org/10.1038/nrn3475">Button et al., 2013</a>).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Simulating-a-simple-paired-$T$-experiment">Simulating a simple paired $T$ experiment<a class="anchor-link" href="#Simulating-a-simple-paired-$T$-experiment">&#182;</a></h2><p>Let's use simulations to understand what the parameters above mean in practice for a researcher working in the field. Here is how one experiment might play out:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulate_iteration</span><span class="p">(</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">):</span>
    <span class="c1"># we can simulate a mean difference by drawing from a Gaussian with d_pop offset</span>
    <span class="n">ttest</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">d_pop</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">ttest</span><span class="o">.</span><span class="n">statistic</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">required_n</span> <span class="o">=</span> <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
        <span class="n">effect_size</span><span class="o">=</span><span class="n">dz</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">ttest</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span>
        <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">ttest</span><span class="o">.</span><span class="n">pvalue</span><span class="p">,</span>
        <span class="s2">&quot;d_z&quot;</span><span class="p">:</span> <span class="n">dz</span><span class="p">,</span>
        <span class="s2">&quot;required_n&quot;</span><span class="p">:</span> <span class="n">required_n</span><span class="p">,</span>
        <span class="s2">&quot;significant&quot;</span><span class="p">:</span> <span class="n">ttest</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">,</span>
    <span class="p">}</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">simulate_iteration</span><span class="p">(</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;d_z_hat: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;d_z&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N_hat (</span><span class="si">{</span><span class="n">power</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% power): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;required_n&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>d_z_hat: 0.73
N_hat (80% power): 17
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We entered a ground-truth effect size of $d_z=0.5$ in the simulation. But if we run the above code cell a few times to simulate repeated experiments with $N=20$, we'll see that the estimate $\hat{d}$ can work out quite differently.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Variability-of-effect-size-estimates">Variability of effect size estimates<a class="anchor-link" href="#Variability-of-effect-size-estimates">&#182;</a></h2><p>Suppose that the above estimate was all we knew about the real effect, and we used it to calculate sample sizes for a new study. We might already suspect that this is going to go badly, but how much of a problem is it really? Let's simulate how this works out over a population of experiments that all explore the same ground-truth effect.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># simulate datasets</span>
<span class="n">n_iter</span> <span class="o">=</span> <span class="mi">5000</span>


<span class="k">def</span> <span class="nf">simulate_data</span><span class="p">(</span><span class="n">n_sim</span><span class="p">,</span> <span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">joblib</span><span class="o">.</span><span class="n">parallel_backend</span><span class="p">(</span><span class="s2">&quot;threading&quot;</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">Parallel</span><span class="p">()(</span>
            <span class="n">joblib</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">simulate_iteration</span><span class="p">)(</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sim</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="n">dz_sim</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">(</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># visualise with a histogram</span>
<span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="n">dz_sim</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">,</span> <span class="n">color_significance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot frequency histogram.&quot;&quot;&quot;</span>

    <span class="n">color_arg</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">color_significance</span><span class="p">:</span>
        <span class="n">color_arg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;significant:N&quot;</span><span class="p">)</span>
    <span class="c1"># NB the width and height arguments here control the overall size of the plot</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">dz_sim</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>
        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;count()&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">color_arg</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">gridlines</span><span class="p">(</span><span class="n">dz_q</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.0%&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add dashed vertical lines to plot. Label the lines in a second panel </span>
<span class="sd">    with a second right axis.&quot;&quot;&quot;</span>
    <span class="c1"># overlay vertical lines at particular percentiles</span>
    <span class="n">vlines</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">dz_q</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mark_rule</span><span class="p">()</span>
        <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;value:Q&quot;</span><span class="p">,</span> <span class="n">strokeDash</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">StrokeDash</span><span class="p">(</span><span class="s2">&quot;style:O&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),)</span>
    <span class="p">)</span>
    <span class="c1"># label the vertical lines with a new axis</span>
    <span class="n">vlabels</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">dz_q</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mark_text</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">baseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;prob:Q&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;value:Q&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
                <span class="s2">&quot;y:O&quot;</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">titleAlign</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">),</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">vlines</span><span class="p">,</span> <span class="n">vlabels</span>


<span class="k">def</span> <span class="nf">style_chart</span><span class="p">(</span><span class="n">handle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make the final chart pretty.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">configure_axis</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="o">.</span><span class="n">configure_view</span><span class="p">(</span><span class="n">strokeWidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">resolve_scale</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;shared&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">configure_concat</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">configure_axisY</span><span class="p">(</span><span class="n">titleAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">titleAlign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">titleBaseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">)</span>
    <span class="p">)</span>


<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">d_pop</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">d_pop</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">hist</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span>
    <span class="n">dz_sim</span><span class="p">,</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="s2">&quot;d_z:Q&quot;</span><span class="p">,</span>
        <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxbins</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">xticks</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;d estimate (N=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;(d population=</span><span class="si">{</span><span class="n">d_pop</span><span class="si">:</span><span class="s2">.1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">color_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># add percentiles of distribution</span>
<span class="n">prctiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]]))</span>
<span class="n">dz_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">prctiles</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dz_sim</span><span class="p">[</span><span class="s2">&quot;d_z&quot;</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">prctiles</span><span class="p">),</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">vlines</span><span class="p">,</span> <span class="n">vlabels</span> <span class="o">=</span> <span class="n">gridlines</span><span class="p">(</span><span class="n">dz_grid</span><span class="p">,</span> <span class="s2">&quot;percentiles&quot;</span><span class="p">)</span>
<span class="n">style_chart</span><span class="p">(</span><span class="n">vlabels</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hist</span> <span class="o">+</span> <span class="n">vlines</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg class="marks" width="538" height="276" viewBox="0 0 538 276" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="538" height="276" fill="white"></rect><g fill="none" stroke-miterlimit="10" transform="translate(65,5)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v0h-400Z"></path><g><g class="mark-group role-scope concat_0_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v20h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'percentiles' for a discrete scale with 1 value: 0"><g transform="translate(400.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,10)" x2="5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="20" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="start" transform="translate(10,13)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">percentiles</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-mark concat_0_marks" role="graphics-object" aria-roledescription="text mark container"><text aria-label="prob: 5%; value: 0.135690481713; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(97.39826940244251,13)" font-family="sans-serif" font-size="11px" fill="black">5%</text><text aria-label="prob: 16%; value: 0.274186174853; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(122.57930451868626,13)" font-family="sans-serif" font-size="11px" fill="black">16%</text><text aria-label="prob: 50%; value: 0.50299977881; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(164.18177796550825,13)" font-family="sans-serif" font-size="11px" fill="black">50%</text><text aria-label="prob: 84%; value: 0.772968395289; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(213.26698096162963,13)" font-family="sans-serif" font-size="11px" fill="black">84%</text><text aria-label="prob: 95%; value: 0.968783081937; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(248.86965126125196,13)" font-family="sans-serif" font-size="11px" fill="black">95%</text></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-scope concat_1_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,21)"><path class="background" aria-hidden="true" d="M0,0h400v200h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'd estimate (N=20) (d population=0.5)' for a linear scale with values from -0.4 to 1.8"><g transform="translate(0.5,200.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(73,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(164,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(255,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(345,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="middle" transform="translate(72.72727272727273,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0.00</text><text text-anchor="middle" transform="translate(163.63636363636363,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0.50</text><text text-anchor="middle" transform="translate(254.5454545454545,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">1.00</text><text text-anchor="middle" transform="translate(345.45454545454544,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">1.50</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="400" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(200,30)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1"><tspan>d estimate (N=20)</tspan><tspan x="0" dy="13">(d population=0.5)</tspan></text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'count' for a linear scale with values from 0 to 450"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,200)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,156)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,111)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,67)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,22)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,203)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,158.55555555555557)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="end" transform="translate(-7,114.11111111111111)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text><text text-anchor="end" transform="translate(-7,69.66666666666667)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">300</text><text text-anchor="end" transform="translate(-7,25.222222222222232)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">400</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,200)" x2="0" y2="-200" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="end" transform="translate(-29,103)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">count</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-rect role-mark concat_1_layer_0_marks" role="graphics-object" aria-roledescription="rect mark container"><path aria-label="d estimate (N=20), (d population=0.5): 0.35  0.4; count: 364" role="graphics-symbol" aria-roledescription="bar" d="M137.36363636363635,38.22222222222222h8.090909090909122v161.77777777777777h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.3  0.35; count: 315" role="graphics-symbol" aria-roledescription="bar" d="M128.27272727272725,60.00000000000001h8.090909090909093v140h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.85  0.9; count: 140" role="graphics-symbol" aria-roledescription="bar" d="M228.27272727272725,137.77777777777777h8.090909090909065v62.22222222222223h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.7  0.75; count: 226" role="graphics-symbol" aria-roledescription="bar" d="M201,99.55555555555556h8.090909090909093v100.44444444444444h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.2  0.25; count: 224" role="graphics-symbol" aria-roledescription="bar" d="M110.09090909090911,100.44444444444444h8.09090909090908v99.55555555555556h-8.09090909090908Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.5  0.55; count: 380" role="graphics-symbol" aria-roledescription="bar" d="M164.63636363636363,31.11111111111111h8.090909090909093v168.88888888888889h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.55  0.6; count: 378" role="graphics-symbol" aria-roledescription="bar" d="M173.72727272727272,32.00000000000001h8.090909090909093v168h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.65  0.7; count: 304" role="graphics-symbol" aria-roledescription="bar" d="M191.9090909090909,64.88888888888889h8.090909090909093v135.11111111111111h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.25  0.3; count: 279" role="graphics-symbol" aria-roledescription="bar" d="M119.18181818181816,76h8.090909090909108v124h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.45  0.5; count: 430" role="graphics-symbol" aria-roledescription="bar" d="M155.54545454545453,8.888888888888879h8.090909090909093v191.11111111111111h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.1  0.15; count: 110" role="graphics-symbol" aria-roledescription="bar" d="M91.9090909090909,151.11111111111111h8.090909090909093v48.888888888888886h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.4  0.45; count: 407" role="graphics-symbol" aria-roledescription="bar" d="M146.45454545454547,19.1111111111111h8.090909090909065v180.8888888888889h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.6  0.65; count: 323" role="graphics-symbol" aria-roledescription="bar" d="M182.8181818181818,56.44444444444445h8.090909090909093v143.55555555555554h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.15  0.2; count: 171" role="graphics-symbol" aria-roledescription="bar" d="M101,124h8.090909090909108v76h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.95  1; count: 81" role="graphics-symbol" aria-roledescription="bar" d="M246.45454545454547,164h8.090909090909037v36h-8.090909090909037Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.05  1.1; count: 49" role="graphics-symbol" aria-roledescription="bar" d="M264.6363636363637,178.22222222222223h8.090909090909008v21.77777777777777h-8.090909090909008Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.8  0.85; count: 167" role="graphics-symbol" aria-roledescription="bar" d="M219.18181818181822,125.77777777777777h8.090909090909065v74.22222222222223h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.75  0.8; count: 220" role="graphics-symbol" aria-roledescription="bar" d="M210.0909090909091,102.22222222222221h8.090909090909122v97.77777777777779h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.1  -0.05; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M55.545454545454554,189.77777777777777h8.090909090909093v10.222222222222229h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.05  0.1; count: 72" role="graphics-symbol" aria-roledescription="bar" d="M82.81818181818181,168h8.090909090909093v32h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.05  0; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M64.63636363636363,190.22222222222223h8.090909090909108v9.777777777777771h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0  0.05; count: 41" role="graphics-symbol" aria-roledescription="bar" d="M73.72727272727273,181.77777777777777h8.09090909090908v18.22222222222223h-8.09090909090908Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.3  -0.25; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M19.181818181818176,199.55555555555554h8.0909090909091v0.4444444444444571h-8.0909090909091Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.3  1.35; count: 8" role="graphics-symbol" aria-roledescription="bar" d="M310.09090909090907,196.44444444444446h8.090909090909122v3.555555555555543h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.35  1.4; count: 7" role="graphics-symbol" aria-roledescription="bar" d="M319.1818181818182,196.88888888888889h8.090909090909008v3.1111111111111143h-8.090909090909008Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 0.9  0.95; count: 89" role="graphics-symbol" aria-roledescription="bar" d="M237.36363636363632,160.44444444444443h8.09090909090915v39.55555555555557h-8.09090909090915Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.15  -0.1; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M46.45454545454545,196h8.0909090909091v4h-8.0909090909091Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1  1.05; count: 57" role="graphics-symbol" aria-roledescription="bar" d="M255.5454545454545,174.66666666666666h8.090909090909065v25.333333333333343h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.1  1.15; count: 26" role="graphics-symbol" aria-roledescription="bar" d="M273.7272727272727,188.44444444444443h8.090909090909065v11.555555555555571h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.2  -0.15; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M37.36363636363637,196h8.090909090909086v4h-8.090909090909086Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.25  1.3; count: 12" role="graphics-symbol" aria-roledescription="bar" d="M300.99999999999994,194.66666666666669h8.090909090909122v5.333333333333314h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.2  1.25; count: 21" role="graphics-symbol" aria-roledescription="bar" d="M291.90909090909093,190.66666666666669h8.090909090909008v9.333333333333314h-8.090909090909008Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.45  1.5; count: 4" role="graphics-symbol" aria-roledescription="bar" d="M337.3636363636363,198.22222222222223h8.090909090909122v1.7777777777777715h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.15  1.2; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M282.81818181818176,189.77777777777777h8.090909090909065v10.222222222222229h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.4  1.45; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M328.2727272727272,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.65  1.7; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M373.72727272727275,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.5  1.55; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M346.45454545454544,199.55555555555554h8.090909090909008v0.4444444444444571h-8.090909090909008Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.25  -0.2; count: 2" role="graphics-symbol" aria-roledescription="bar" d="M28.272727272727277,199.11111111111111h8.09090909090909v0.8888888888888857h-8.09090909090909Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): -0.4  -0.35; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M1,199.55555555555554h8.090909090909088v0.4444444444444571h-8.090909090909088Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.6  1.65; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M364.6363636363636,199.55555555555554h8.090909090909122v0.4444444444444571h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="d estimate (N=20), (d population=0.5): 1.7  1.75; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M382.8181818181818,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#4c78a8"></path></g><g class="mark-rule role-mark concat_1_layer_1_marks" role="graphics-object" aria-roledescription="rule mark container"><line aria-label="style: 2; value: 0.135690481713" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(97.39826940244251,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line><line aria-label="style: 1; value: 0.274186174853" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(122.57930451868626,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 0; value: 0.50299977881" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(164.18177796550825,0)" x2="0" y2="200" stroke="black" stroke-dasharray="1,0"></line><line aria-label="style: 1; value: 0.772968395289" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(213.26698096162963,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 2; value: 0.968783081937" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(248.86965126125196,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The histogram above summarizes the $\hat{d}$ estimates for all the simulated experiments. There is quite a bit of variability around the ground-truth $d_z=0.5$. For instance, the central 68% of the distribution (analogous to 1 standard deviation about the mean for a Gaussian) runs from around 0.25 to 0.75 for the simulated $N=20$ scenario.</p>
<h3 id="Analytical-approximation-of-effect-size-variance">Analytical approximation of effect size variance<a class="anchor-link" href="#Analytical-approximation-of-effect-size-variance">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By the way, we don't have to do numerical simulations to obtain a standard-deviation estimate for $d_z$ - there is a large-sample approximation (<a href="https://doi.org/10.3102%2F10769986018003271">Gibbons et al., 1993</a>):</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
$$\sigma[d_z] = \sqrt{\frac{1}{n} + \frac{d_z^2}{2 \times n}}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How does the parametric approximation compare to the percentiles in our simulated distribution? Let's compare:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Gibbons et al approximation</span>
<span class="k">def</span> <span class="nf">dz_std</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">))</span>


<span class="n">dz_var</span> <span class="o">=</span> <span class="n">dz_std</span><span class="p">(</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sigma(d_z) parametric approximation</span><span class="se">\n\t</span><span class="si">{</span><span class="n">dz_var</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># how does that compare to the percentiles of our distribution?</span>
<span class="n">lower</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dz_grid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dz_grid</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="o">-</span> <span class="n">dz_grid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dz_grid</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">dz_grid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dz_grid</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="o">-</span> <span class="n">dz_grid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dz_grid</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;simulated sigma(d_z)</span><span class="se">\n</span><span class="s2">lower:</span><span class="se">\t</span><span class="si">{</span><span class="n">lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">upper:</span><span class="se">\t</span><span class="si">{</span><span class="n">upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>sigma(d_z) parametric approximation
	0.24
simulated sigma(d_z)
lower:	0.23
upper:	0.27
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Not too bad. So we don't need to resort to simulations to have an idea of how variable a given $d_z$ estimate is likely to be - we just need the sample size of the study the estimate came from.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Consequences-for-sample-size-calculations">Consequences for sample size calculations<a class="anchor-link" href="#Consequences-for-sample-size-calculations">&#182;</a></h3><p>Let's make this a bit more concrete by calculating the sample sizes that would result if you used the estimated $\hat{d}$ from one of these experiments to power a new study.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hist_n</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span>
    <span class="n">dz_sim</span><span class="p">,</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;required_n:Q&quot;</span><span class="p">,</span>
        <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;required sample size (N), capped at 200&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">color_significance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">power_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">dz_n</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">power_values</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
                <span class="n">effect_size</span><span class="o">=</span><span class="n">d_pop</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">this_power</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">this_power</span> <span class="ow">in</span> <span class="n">power_values</span>
        <span class="p">],</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">vlines_n</span><span class="p">,</span> <span class="n">vlabels_n</span> <span class="o">=</span> <span class="n">gridlines</span><span class="p">(</span><span class="n">dz_n</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;power (d=</span><span class="si">{</span><span class="n">d_pop</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">style_chart</span><span class="p">(</span><span class="n">vlabels_n</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hist_n</span> <span class="o">+</span> <span class="n">vlines_n</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg class="marks" width="552" height="267" viewBox="0 0 552 267" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="552" height="267" fill="white"></rect><g fill="none" stroke-miterlimit="10" transform="translate(65,5)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v0h-400Z"></path><g><g class="mark-group role-scope concat_0_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v20h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'power (d=0.5)' for a discrete scale with 1 value: 0"><g transform="translate(400.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,10)" x2="5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="20" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="start" transform="translate(10,13)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">power (d=0.5)</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-mark concat_0_marks" role="graphics-object" aria-roledescription="text mark container"><text aria-label="prob: 20%; value: 6.95678082972; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(13.91356165943263,13)" font-family="sans-serif" font-size="11px" fill="black">20%</text><text aria-label="prob: 80%; value: 33.3671314275; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(66.7342628550416,13)" font-family="sans-serif" font-size="11px" fill="black">80%</text><text aria-label="prob: 95%; value: 53.9406174268; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(107.88123485355956,13)" font-family="sans-serif" font-size="11px" fill="black">95%</text></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-scope concat_1_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,25)"><path class="background" aria-hidden="true" d="M0,0h400v200h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'required sample size (N), capped at 200' for a linear scale with values from 0 to 200"><g transform="translate(0.5,200.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(10,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(20,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(30,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(40,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(50,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(60,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(70,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(80,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(90,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(100,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(110,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(120,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(130,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(140,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(150,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(160,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(170,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(180,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(190,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(200,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(210,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(220,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(230,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(240,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(250,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(260,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(270,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(280,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(290,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(300,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(310,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(320,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(330,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(340,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(350,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(360,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(370,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(380,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(390,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(400,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="start" transform="translate(0,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="middle" transform="translate(10,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">5</text><text text-anchor="middle" transform="translate(20,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">10</text><text text-anchor="middle" transform="translate(30,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">15</text><text text-anchor="middle" transform="translate(40,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">20</text><text text-anchor="middle" transform="translate(50,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">25</text><text text-anchor="middle" transform="translate(60,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">30</text><text text-anchor="middle" transform="translate(70,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">35</text><text text-anchor="middle" transform="translate(80,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">40</text><text text-anchor="middle" transform="translate(90,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">45</text><text text-anchor="middle" transform="translate(100,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">50</text><text text-anchor="middle" transform="translate(110.00000000000001,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">55</text><text text-anchor="middle" transform="translate(120,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">60</text><text text-anchor="middle" transform="translate(130,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">65</text><text text-anchor="middle" transform="translate(140,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">70</text><text text-anchor="middle" transform="translate(150,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">75</text><text text-anchor="middle" transform="translate(160,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">80</text><text text-anchor="middle" transform="translate(170,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">85</text><text text-anchor="middle" transform="translate(180,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">90</text><text text-anchor="middle" transform="translate(190,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">95</text><text text-anchor="middle" transform="translate(200,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="middle" transform="translate(210,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">105</text><text text-anchor="middle" transform="translate(220.00000000000003,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">110</text><text text-anchor="middle" transform="translate(229.99999999999997,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">115</text><text text-anchor="middle" transform="translate(240,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">120</text><text text-anchor="middle" transform="translate(250,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">125</text><text text-anchor="middle" transform="translate(260,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">130</text><text text-anchor="middle" transform="translate(270,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">135</text><text text-anchor="middle" transform="translate(280,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">140</text><text text-anchor="middle" transform="translate(290,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">145</text><text text-anchor="middle" transform="translate(300,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">150</text><text text-anchor="middle" transform="translate(310,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">155</text><text text-anchor="middle" transform="translate(320,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">160</text><text text-anchor="middle" transform="translate(330,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">165</text><text text-anchor="middle" transform="translate(340,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">170</text><text text-anchor="middle" transform="translate(350,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">175</text><text text-anchor="middle" transform="translate(360,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">180</text><text text-anchor="middle" transform="translate(370,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">185</text><text text-anchor="middle" transform="translate(380,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">190</text><text text-anchor="middle" transform="translate(390,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">195</text><text text-anchor="end" transform="translate(400,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="400" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(200,30)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">required sample size (N), capped at 200</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'count' for a linear scale with values from 0 to 600"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,200)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,167)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,133)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,100)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,67)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,33)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,0)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,203)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,169.66666666666669)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="end" transform="translate(-7,136.33333333333334)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text><text text-anchor="end" transform="translate(-7,103)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">300</text><text text-anchor="end" transform="translate(-7,69.66666666666667)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">400</text><text text-anchor="end" transform="translate(-7,36.33333333333333)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">500</text><text text-anchor="end" transform="translate(-7,3)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">600</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,200)" x2="0" y2="-200" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="end" transform="translate(-29,103)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">count</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-rect role-mark concat_1_layer_0_marks" role="graphics-object" aria-roledescription="rect mark container"><path aria-label="required sample size (N), capped at 200: 55  60; count: 131" role="graphics-symbol" aria-roledescription="bar" d="M111.00000000000001,156.33333333333334h8.999999999999986v43.66666666666666h-8.999999999999986Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 65  70; count: 89" role="graphics-symbol" aria-roledescription="bar" d="M131,170.33333333333334h9v29.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 60  65; count: 106" role="graphics-symbol" aria-roledescription="bar" d="M121,164.66666666666669h9v35.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 10  15; count: 555" role="graphics-symbol" aria-roledescription="bar" d="M21,14.999999999999991h9v185h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 15  20; count: 596" role="graphics-symbol" aria-roledescription="bar" d="M31,1.333333333333342h9v198.66666666666666h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 185  190; count: 15" role="graphics-symbol" aria-roledescription="bar" d="M371,195h9v5h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 30  35; count: 304" role="graphics-symbol" aria-roledescription="bar" d="M61,98.66666666666666h9v101.33333333333334h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 25  30; count: 440" role="graphics-symbol" aria-roledescription="bar" d="M51,53.33333333333334h9v146.66666666666666h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 120  125; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M241,192.33333333333334h9v7.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 140  145; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M281,192.66666666666669h9v7.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 40  45; count: 232" role="graphics-symbol" aria-roledescription="bar" d="M81,122.66666666666666h9v77.33333333333334h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 100  105; count: 32" role="graphics-symbol" aria-roledescription="bar" d="M201,189.33333333333334h9v10.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 50  55; count: 148" role="graphics-symbol" aria-roledescription="bar" d="M101,150.66666666666666h9.000000000000014v49.33333333333334h-9.000000000000014Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 20  25; count: 504" role="graphics-symbol" aria-roledescription="bar" d="M41,32.00000000000001h9v168h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 45  50; count: 185" role="graphics-symbol" aria-roledescription="bar" d="M91,138.33333333333334h9v61.66666666666666h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 110  115; count: 25" role="graphics-symbol" aria-roledescription="bar" d="M221.00000000000003,191.66666666666669h8.999999999999943v8.333333333333314h-8.999999999999943Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 90  95; count: 57" role="graphics-symbol" aria-roledescription="bar" d="M181,181h9v19h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 5  10; count: 217" role="graphics-symbol" aria-roledescription="bar" d="M11,127.66666666666666h9v72.33333333333334h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 70  75; count: 71" role="graphics-symbol" aria-roledescription="bar" d="M141,176.33333333333334h9v23.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 75  80; count: 55" role="graphics-symbol" aria-roledescription="bar" d="M151,181.66666666666666h9v18.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 85  90; count: 67" role="graphics-symbol" aria-roledescription="bar" d="M171,177.66666666666666h9v22.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 35  40; count: 287" role="graphics-symbol" aria-roledescription="bar" d="M71,104.33333333333334h9v95.66666666666666h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 80  85; count: 62" role="graphics-symbol" aria-roledescription="bar" d="M161,179.33333333333334h9v20.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 160  165; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M321,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 115  120; count: 28" role="graphics-symbol" aria-roledescription="bar" d="M230.99999999999997,190.66666666666669h9.000000000000028v9.333333333333314h-9.000000000000028Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 180  185; count: 11" role="graphics-symbol" aria-roledescription="bar" d="M361,196.33333333333334h9v3.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 195  200; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M391,197h9v3h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 125  130; count: 20" role="graphics-symbol" aria-roledescription="bar" d="M251,193.33333333333334h9v6.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 170  175; count: 13" role="graphics-symbol" aria-roledescription="bar" d="M341,195.66666666666666h9v4.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 145  150; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M291,192.66666666666669h9v7.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 165  170; count: 15" role="graphics-symbol" aria-roledescription="bar" d="M331,195h9v5h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 155  160; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M311,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 150  155; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M301,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 95  100; count: 54" role="graphics-symbol" aria-roledescription="bar" d="M191,182h9v18h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 105  110; count: 38" role="graphics-symbol" aria-roledescription="bar" d="M211,187.33333333333334h9.000000000000028v12.666666666666657h-9.000000000000028Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 135  140; count: 18" role="graphics-symbol" aria-roledescription="bar" d="M271,194h9v6h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 175  180; count: 19" role="graphics-symbol" aria-roledescription="bar" d="M351,193.66666666666669h9v6.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 130  135; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M261,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 190  195; count: 8" role="graphics-symbol" aria-roledescription="bar" d="M381,197.33333333333334h9v2.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="required sample size (N), capped at 200: 0  5; count: 2" role="graphics-symbol" aria-roledescription="bar" d="M1,199.33333333333334h9v0.6666666666666572h-9Z" fill="#4c78a8"></path></g><g class="mark-rule role-mark concat_1_layer_1_marks" role="graphics-object" aria-roledescription="rule mark container"><line aria-label="style: 2; value: 6.95678082972" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(13.91356165943263,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line><line aria-label="style: 1; value: 33.3671314275" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(66.7342628550416,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 0; value: 53.9406174268" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(107.88123485355956,0)" x2="0" y2="200" stroke="black" stroke-dasharray="1,0"></line></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a long-tailed distribution since the required sample size goes to infinity as the sample effect size approaches zero (notice that I only plot bins up to n=200 - there are values into the thousands). The overlaid vertical lines indicate the achieved power for the <em>population</em> effect size. The median of the sample-size distribution is close to the size that achieves 80% power:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N (median estimate): </span><span class="si">{x:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dz_sim</span><span class="p">[</span><span class="s2">&quot;required_n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;N (ground truth, </span><span class="si">{power:.0f}</span><span class="s2">% power): </span><span class="si">{x:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">n_for_80</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>N (median estimate): 32.99
N (ground truth, 80% power): 33.37
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So on <del>average</del> median, we are getting a reasonable answer by powering new studies based on an underpowered initial study. We are as likely to end up under- or over-powered. But let's appreciate that there is <em>a lot</em> of variability. If you calculate sample sizes according to any one of these estimates, you could easily end up with a sample size that is  underpowered with respect to the ground-truth effect size, or with a calculation that suggests an astronomical sample size would be required for adequate power. You might just give up at that point instead of running further studies. Which brings us to the next point...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bias-in-effect-size-estimates">Bias in effect size estimates<a class="anchor-link" href="#Bias-in-effect-size-estimates">&#182;</a></h2><p>A $\hat{d}$ estimate from a small previous study is not only going to be an uncertain estimate, in practice it will probably be <em>biased</em> too. There are many bias sources, but the most obvious arises from the combination of null-hypothesis significance testing and the well-known reluctance to publish non-significant tests (the <a href="https://en.wikipedia.org/wiki/Publication_bias">file drawer problem</a>). It's unlikely we would be planning a new study unless the previous study had significant tests, so let's suppose we are only going to consider the part of the $\hat{d}$ distribution that achieved significance:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># histogram of d over simulations, coloured by significance</span>
<span class="n">hist_sig</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span>
    <span class="n">dz_sim</span><span class="p">,</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="s2">&quot;d_z:Q&quot;</span><span class="p">,</span>
        <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxbins</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">xticks</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;d estimate (N=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;(d population=</span><span class="si">{</span><span class="n">d_pop</span><span class="si">:</span><span class="s2">.1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">color_significance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">style_chart</span><span class="p">(</span><span class="n">vlabels</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hist_sig</span> <span class="o">+</span> <span class="n">vlines</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg class="marks" width="612" height="276" viewBox="0 0 612 276" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="612" height="276" fill="white"></rect><g fill="none" stroke-miterlimit="10" transform="translate(65,5)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v0h-400Z"></path><g><g class="mark-group role-scope concat_0_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v20h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'percentiles' for a discrete scale with 1 value: 0"><g transform="translate(400.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,10)" x2="5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="20" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="start" transform="translate(10,13)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">percentiles</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-mark concat_0_marks" role="graphics-object" aria-roledescription="text mark container"><text aria-label="prob: 5%; value: 0.135690481713; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(97.39826940244251,13)" font-family="sans-serif" font-size="11px" fill="black">5%</text><text aria-label="prob: 16%; value: 0.274186174853; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(122.57930451868626,13)" font-family="sans-serif" font-size="11px" fill="black">16%</text><text aria-label="prob: 50%; value: 0.50299977881; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(164.18177796550825,13)" font-family="sans-serif" font-size="11px" fill="black">50%</text><text aria-label="prob: 84%; value: 0.772968395289; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(213.26698096162963,13)" font-family="sans-serif" font-size="11px" fill="black">84%</text><text aria-label="prob: 95%; value: 0.968783081937; percentiles: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(248.86965126125196,13)" font-family="sans-serif" font-size="11px" fill="black">95%</text></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-scope concat_1_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,21)"><path class="background" aria-hidden="true" d="M0,0h400v200h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'd estimate (N=20) (d population=0.5)' for a linear scale with values from -0.4 to 1.8"><g transform="translate(0.5,200.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(73,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(164,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(255,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(345,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="middle" transform="translate(72.72727272727273,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0.00</text><text text-anchor="middle" transform="translate(163.63636363636363,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0.50</text><text text-anchor="middle" transform="translate(254.5454545454545,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">1.00</text><text text-anchor="middle" transform="translate(345.45454545454544,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">1.50</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="400" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(200,30)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1"><tspan>d estimate (N=20)</tspan><tspan x="0" dy="13">(d population=0.5)</tspan></text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'count' for a linear scale with values from 0 to 450"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,200)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,156)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,111)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,67)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,22)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,203)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,158.55555555555557)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="end" transform="translate(-7,114.11111111111111)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text><text text-anchor="end" transform="translate(-7,69.66666666666667)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">300</text><text text-anchor="end" transform="translate(-7,25.222222222222232)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">400</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,200)" x2="0" y2="-200" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="end" transform="translate(-29,103)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">count</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-rect role-mark concat_1_layer_0_marks" role="graphics-object" aria-roledescription="rect mark container"><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.35  0.4; count: 364" role="graphics-symbol" aria-roledescription="bar" d="M137.36363636363635,38.22222222222222h8.090909090909122v161.77777777777777h-8.090909090909122Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.3  0.35; count: 315" role="graphics-symbol" aria-roledescription="bar" d="M128.27272727272725,60.00000000000001h8.090909090909093v140h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.85  0.9; count: 140" role="graphics-symbol" aria-roledescription="bar" d="M228.27272727272725,137.77777777777777h8.090909090909065v62.22222222222223h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.7  0.75; count: 226" role="graphics-symbol" aria-roledescription="bar" d="M201,99.55555555555556h8.090909090909093v100.44444444444444h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.2  0.25; count: 224" role="graphics-symbol" aria-roledescription="bar" d="M110.09090909090911,100.44444444444444h8.09090909090908v99.55555555555556h-8.09090909090908Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.5  0.55; count: 380" role="graphics-symbol" aria-roledescription="bar" d="M164.63636363636363,31.11111111111111h8.090909090909093v168.88888888888889h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.55  0.6; count: 378" role="graphics-symbol" aria-roledescription="bar" d="M173.72727272727272,32.00000000000001h8.090909090909093v168h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.65  0.7; count: 304" role="graphics-symbol" aria-roledescription="bar" d="M191.9090909090909,64.88888888888889h8.090909090909093v135.11111111111111h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.25  0.3; count: 279" role="graphics-symbol" aria-roledescription="bar" d="M119.18181818181816,76h8.090909090909108v124h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.45  0.5; count: 148" role="graphics-symbol" aria-roledescription="bar" d="M155.54545454545453,8.888888888888879h8.090909090909093v65.77777777777777h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.1  0.15; count: 110" role="graphics-symbol" aria-roledescription="bar" d="M91.9090909090909,151.11111111111111h8.090909090909093v48.888888888888886h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.4  0.45; count: 407" role="graphics-symbol" aria-roledescription="bar" d="M146.45454545454547,19.1111111111111h8.090909090909065v180.8888888888889h-8.090909090909065Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.6  0.65; count: 323" role="graphics-symbol" aria-roledescription="bar" d="M182.8181818181818,56.44444444444445h8.090909090909093v143.55555555555554h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.15  0.2; count: 171" role="graphics-symbol" aria-roledescription="bar" d="M101,124h8.090909090909108v76h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.95  1; count: 81" role="graphics-symbol" aria-roledescription="bar" d="M246.45454545454547,164h8.090909090909037v36h-8.090909090909037Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.05  1.1; count: 49" role="graphics-symbol" aria-roledescription="bar" d="M264.6363636363637,178.22222222222223h8.090909090909008v21.77777777777777h-8.090909090909008Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.8  0.85; count: 167" role="graphics-symbol" aria-roledescription="bar" d="M219.18181818181822,125.77777777777777h8.090909090909065v74.22222222222223h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.45  0.5; count: 282" role="graphics-symbol" aria-roledescription="bar" d="M155.54545454545453,74.66666666666666h8.090909090909093v125.33333333333334h-8.090909090909093Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.75  0.8; count: 220" role="graphics-symbol" aria-roledescription="bar" d="M210.0909090909091,102.22222222222221h8.090909090909122v97.77777777777779h-8.090909090909122Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.1  -0.05; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M55.545454545454554,189.77777777777777h8.090909090909093v10.222222222222229h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0.05  0.1; count: 72" role="graphics-symbol" aria-roledescription="bar" d="M82.81818181818181,168h8.090909090909093v32h-8.090909090909093Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.05  0; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M64.63636363636363,190.22222222222223h8.090909090909108v9.777777777777771h-8.090909090909108Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): 0  0.05; count: 41" role="graphics-symbol" aria-roledescription="bar" d="M73.72727272727273,181.77777777777777h8.09090909090908v18.22222222222223h-8.09090909090908Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.3  -0.25; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M19.181818181818176,199.55555555555554h8.0909090909091v0.4444444444444571h-8.0909090909091Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.3  1.35; count: 8" role="graphics-symbol" aria-roledescription="bar" d="M310.09090909090907,196.44444444444446h8.090909090909122v3.555555555555543h-8.090909090909122Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.35  1.4; count: 7" role="graphics-symbol" aria-roledescription="bar" d="M319.1818181818182,196.88888888888889h8.090909090909008v3.1111111111111143h-8.090909090909008Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 0.9  0.95; count: 89" role="graphics-symbol" aria-roledescription="bar" d="M237.36363636363632,160.44444444444443h8.09090909090915v39.55555555555557h-8.09090909090915Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.15  -0.1; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M46.45454545454545,196h8.0909090909091v4h-8.0909090909091Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1  1.05; count: 57" role="graphics-symbol" aria-roledescription="bar" d="M255.5454545454545,174.66666666666666h8.090909090909065v25.333333333333343h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.1  1.15; count: 26" role="graphics-symbol" aria-roledescription="bar" d="M273.7272727272727,188.44444444444443h8.090909090909065v11.555555555555571h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.2  -0.15; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M37.36363636363637,196h8.090909090909086v4h-8.090909090909086Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.25  1.3; count: 12" role="graphics-symbol" aria-roledescription="bar" d="M300.99999999999994,194.66666666666669h8.090909090909122v5.333333333333314h-8.090909090909122Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.2  1.25; count: 21" role="graphics-symbol" aria-roledescription="bar" d="M291.90909090909093,190.66666666666669h8.090909090909008v9.333333333333314h-8.090909090909008Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.45  1.5; count: 4" role="graphics-symbol" aria-roledescription="bar" d="M337.3636363636363,198.22222222222223h8.090909090909122v1.7777777777777715h-8.090909090909122Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.15  1.2; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M282.81818181818176,189.77777777777777h8.090909090909065v10.222222222222229h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.4  1.45; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M328.2727272727272,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.65  1.7; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M373.72727272727275,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.5  1.55; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M346.45454545454544,199.55555555555554h8.090909090909008v0.4444444444444571h-8.090909090909008Z" fill="#f58518"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.25  -0.2; count: 2" role="graphics-symbol" aria-roledescription="bar" d="M28.272727272727277,199.11111111111111h8.09090909090909v0.8888888888888857h-8.09090909090909Z" fill="#4c78a8"></path><path aria-label="significant: false; d estimate (N=20), (d population=0.5): -0.4  -0.35; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M1,199.55555555555554h8.090909090909088v0.4444444444444571h-8.090909090909088Z" fill="#4c78a8"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.6  1.65; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M364.6363636363636,199.55555555555554h8.090909090909122v0.4444444444444571h-8.090909090909122Z" fill="#f58518"></path><path aria-label="significant: true; d estimate (N=20), (d population=0.5): 1.7  1.75; count: 1" role="graphics-symbol" aria-roledescription="bar" d="M382.8181818181818,199.55555555555554h8.090909090909065v0.4444444444444571h-8.090909090909065Z" fill="#f58518"></path></g><g class="mark-rule role-mark concat_1_layer_1_marks" role="graphics-object" aria-roledescription="rule mark container"><line aria-label="style: 2; value: 0.135690481713" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(97.39826940244251,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line><line aria-label="style: 1; value: 0.274186174853" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(122.57930451868626,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 0; value: 0.50299977881" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(164.18177796550825,0)" x2="0" y2="200" stroke="black" stroke-dasharray="1,0"></line><line aria-label="style: 1; value: 0.772968395289" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(213.26698096162963,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 2; value: 0.968783081937" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(248.86965126125196,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-legend" role="graphics-symbol" aria-roledescription="legend" aria-label="Symbol legend titled 'significant' for fill color with 2 values: false, true"><g transform="translate(486,0)"><path class="background" aria-hidden="true" d="M0,0h56v40h-56Z" pointer-events="none"></path><g><g class="mark-group role-legend-entry"><g transform="translate(0,16)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-group role-scope" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h38v11h-38Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" fill="#4c78a8" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">false</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g><g transform="translate(0,13)"><path class="background" aria-hidden="true" d="M0,0h38v11h-38Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" fill="#f58518" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">true</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-legend-title" pointer-events="none"><text text-anchor="start" transform="translate(0,9)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">significant</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We saw previously that power is just over 50% for this simulation, so we should not be surprised to see that roughly that proportion of the simulations produced significant tests. What if those significant tests were all that we knew about the effect size, and we went ahead and calculated sample size requirements using only those results?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hist_n_sig</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">(</span>
    <span class="n">dz_sim</span><span class="p">,</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;required_n:Q&quot;</span><span class="p">,</span>
        <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">]),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;required sample size (N), capped at 200&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">color_significance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">style_chart</span><span class="p">(</span><span class="n">vlabels_n</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hist_n_sig</span> <span class="o">+</span> <span class="n">vlines_n</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg class="marks" width="626" height="267" viewBox="0 0 626 267" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><rect width="626" height="267" fill="white"></rect><g fill="none" stroke-miterlimit="10" transform="translate(65,5)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v0h-400Z"></path><g><g class="mark-group role-scope concat_0_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h400v20h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'power (d=0.5)' for a discrete scale with 1 value: 0"><g transform="translate(400.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,10)" x2="5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="20" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="start" transform="translate(10,13)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">power (d=0.5)</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-mark concat_0_marks" role="graphics-object" aria-roledescription="text mark container"><text aria-label="prob: 20%; value: 6.95678082972; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(13.91356165943263,13)" font-family="sans-serif" font-size="11px" fill="black">20%</text><text aria-label="prob: 80%; value: 33.3671314275; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(66.7342628550416,13)" font-family="sans-serif" font-size="11px" fill="black">80%</text><text aria-label="prob: 95%; value: 53.9406174268; power (d=0.5): 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(107.88123485355956,13)" font-family="sans-serif" font-size="11px" fill="black">95%</text></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-scope concat_1_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,25)"><path class="background" aria-hidden="true" d="M0,0h400v200h-400Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'required sample size (N), capped at 200' for a linear scale with values from 0 to 200"><g transform="translate(0.5,200.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(10,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(20,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(30,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(40,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(50,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(60,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(70,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(80,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(90,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(100,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(110,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(120,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(130,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(140,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(150,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(160,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(170,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(180,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(190,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(200,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(210,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(220,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(230,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(240,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(250,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(260,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(270,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(280,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(290,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(300,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(310,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(320,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(330,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(340,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(350,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(360,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(370,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(380,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(390,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(400,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="start" transform="translate(0,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="middle" transform="translate(10,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">5</text><text text-anchor="middle" transform="translate(20,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">10</text><text text-anchor="middle" transform="translate(30,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">15</text><text text-anchor="middle" transform="translate(40,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">20</text><text text-anchor="middle" transform="translate(50,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">25</text><text text-anchor="middle" transform="translate(60,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">30</text><text text-anchor="middle" transform="translate(70,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">35</text><text text-anchor="middle" transform="translate(80,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">40</text><text text-anchor="middle" transform="translate(90,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">45</text><text text-anchor="middle" transform="translate(100,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">50</text><text text-anchor="middle" transform="translate(110.00000000000001,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">55</text><text text-anchor="middle" transform="translate(120,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">60</text><text text-anchor="middle" transform="translate(130,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">65</text><text text-anchor="middle" transform="translate(140,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">70</text><text text-anchor="middle" transform="translate(150,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">75</text><text text-anchor="middle" transform="translate(160,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">80</text><text text-anchor="middle" transform="translate(170,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">85</text><text text-anchor="middle" transform="translate(180,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">90</text><text text-anchor="middle" transform="translate(190,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">95</text><text text-anchor="middle" transform="translate(200,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="middle" transform="translate(210,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">105</text><text text-anchor="middle" transform="translate(220.00000000000003,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">110</text><text text-anchor="middle" transform="translate(229.99999999999997,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">115</text><text text-anchor="middle" transform="translate(240,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">120</text><text text-anchor="middle" transform="translate(250,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">125</text><text text-anchor="middle" transform="translate(260,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">130</text><text text-anchor="middle" transform="translate(270,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">135</text><text text-anchor="middle" transform="translate(280,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">140</text><text text-anchor="middle" transform="translate(290,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">145</text><text text-anchor="middle" transform="translate(300,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">150</text><text text-anchor="middle" transform="translate(310,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">155</text><text text-anchor="middle" transform="translate(320,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">160</text><text text-anchor="middle" transform="translate(330,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">165</text><text text-anchor="middle" transform="translate(340,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">170</text><text text-anchor="middle" transform="translate(350,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">175</text><text text-anchor="middle" transform="translate(360,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">180</text><text text-anchor="middle" transform="translate(370,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">185</text><text text-anchor="middle" transform="translate(380,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">190</text><text text-anchor="middle" transform="translate(390,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="0">195</text><text text-anchor="end" transform="translate(400,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="400" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(200,30)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">required sample size (N), capped at 200</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'count' for a linear scale with values from 0 to 600"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,200)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,167)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,133)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,100)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,67)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,33)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,0)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,203)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,169.66666666666669)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="end" transform="translate(-7,136.33333333333334)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text><text text-anchor="end" transform="translate(-7,103)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">300</text><text text-anchor="end" transform="translate(-7,69.66666666666667)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">400</text><text text-anchor="end" transform="translate(-7,36.33333333333333)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">500</text><text text-anchor="end" transform="translate(-7,3)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">600</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,200)" x2="0" y2="-200" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="end" transform="translate(-29,103)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">count</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-rect role-mark concat_1_layer_0_marks" role="graphics-object" aria-roledescription="rect mark container"><path aria-label="significant: false; required sample size (N), capped at 200: 55  60; count: 131" role="graphics-symbol" aria-roledescription="bar" d="M111.00000000000001,156.33333333333334h8.999999999999986v43.66666666666666h-8.999999999999986Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 65  70; count: 89" role="graphics-symbol" aria-roledescription="bar" d="M131,170.33333333333334h9v29.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 60  65; count: 106" role="graphics-symbol" aria-roledescription="bar" d="M121,164.66666666666669h9v35.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 10  15; count: 555" role="graphics-symbol" aria-roledescription="bar" d="M21,14.999999999999991h9v185h-9Z" fill="#f58518"></path><path aria-label="significant: true; required sample size (N), capped at 200: 15  20; count: 596" role="graphics-symbol" aria-roledescription="bar" d="M31,1.333333333333342h9v198.66666666666666h-9Z" fill="#f58518"></path><path aria-label="significant: false; required sample size (N), capped at 200: 185  190; count: 15" role="graphics-symbol" aria-roledescription="bar" d="M371,195h9v5h-9Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 30  35; count: 304" role="graphics-symbol" aria-roledescription="bar" d="M61,98.66666666666666h9v101.33333333333334h-9Z" fill="#f58518"></path><path aria-label="significant: true; required sample size (N), capped at 200: 25  30; count: 440" role="graphics-symbol" aria-roledescription="bar" d="M51,53.33333333333334h9v146.66666666666666h-9Z" fill="#f58518"></path><path aria-label="significant: false; required sample size (N), capped at 200: 120  125; count: 23" role="graphics-symbol" aria-roledescription="bar" d="M241,192.33333333333334h9v7.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 140  145; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M281,192.66666666666669h9v7.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 40  45; count: 232" role="graphics-symbol" aria-roledescription="bar" d="M81,122.66666666666666h9v77.33333333333334h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 100  105; count: 32" role="graphics-symbol" aria-roledescription="bar" d="M201,189.33333333333334h9v10.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 50  55; count: 148" role="graphics-symbol" aria-roledescription="bar" d="M101,150.66666666666666h9.000000000000014v49.33333333333334h-9.000000000000014Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 20  25; count: 504" role="graphics-symbol" aria-roledescription="bar" d="M41,32.00000000000001h9v168h-9Z" fill="#f58518"></path><path aria-label="significant: false; required sample size (N), capped at 200: 45  50; count: 185" role="graphics-symbol" aria-roledescription="bar" d="M91,138.33333333333334h9v61.66666666666666h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 110  115; count: 25" role="graphics-symbol" aria-roledescription="bar" d="M221.00000000000003,191.66666666666669h8.999999999999943v8.333333333333314h-8.999999999999943Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 90  95; count: 57" role="graphics-symbol" aria-roledescription="bar" d="M181,181h9v19h-9Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 5  10; count: 217" role="graphics-symbol" aria-roledescription="bar" d="M11,127.66666666666666h9v72.33333333333334h-9Z" fill="#f58518"></path><path aria-label="significant: false; required sample size (N), capped at 200: 70  75; count: 71" role="graphics-symbol" aria-roledescription="bar" d="M141,176.33333333333334h9v23.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 75  80; count: 55" role="graphics-symbol" aria-roledescription="bar" d="M151,181.66666666666666h9v18.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 85  90; count: 67" role="graphics-symbol" aria-roledescription="bar" d="M171,177.66666666666666h9v22.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 35  40; count: 184" role="graphics-symbol" aria-roledescription="bar" d="M71,138.66666666666669h9v61.333333333333314h-9Z" fill="#f58518"></path><path aria-label="significant: false; required sample size (N), capped at 200: 80  85; count: 62" role="graphics-symbol" aria-roledescription="bar" d="M161,179.33333333333334h9v20.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 160  165; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M321,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 35  40; count: 103" role="graphics-symbol" aria-roledescription="bar" d="M71,104.33333333333334h9v34.33333333333334h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 115  120; count: 28" role="graphics-symbol" aria-roledescription="bar" d="M230.99999999999997,190.66666666666669h9.000000000000028v9.333333333333314h-9.000000000000028Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 180  185; count: 11" role="graphics-symbol" aria-roledescription="bar" d="M361,196.33333333333334h9v3.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 195  200; count: 9" role="graphics-symbol" aria-roledescription="bar" d="M391,197h9v3h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 125  130; count: 20" role="graphics-symbol" aria-roledescription="bar" d="M251,193.33333333333334h9v6.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 170  175; count: 13" role="graphics-symbol" aria-roledescription="bar" d="M341,195.66666666666666h9v4.333333333333343h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 145  150; count: 22" role="graphics-symbol" aria-roledescription="bar" d="M291,192.66666666666669h9v7.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 165  170; count: 15" role="graphics-symbol" aria-roledescription="bar" d="M331,195h9v5h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 155  160; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M311,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 150  155; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M301,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 95  100; count: 54" role="graphics-symbol" aria-roledescription="bar" d="M191,182h9v18h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 105  110; count: 38" role="graphics-symbol" aria-roledescription="bar" d="M211,187.33333333333334h9.000000000000028v12.666666666666657h-9.000000000000028Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 135  140; count: 18" role="graphics-symbol" aria-roledescription="bar" d="M271,194h9v6h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 175  180; count: 19" role="graphics-symbol" aria-roledescription="bar" d="M351,193.66666666666669h9v6.333333333333314h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 130  135; count: 17" role="graphics-symbol" aria-roledescription="bar" d="M261,194.33333333333334h9v5.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: false; required sample size (N), capped at 200: 190  195; count: 8" role="graphics-symbol" aria-roledescription="bar" d="M381,197.33333333333334h9v2.666666666666657h-9Z" fill="#4c78a8"></path><path aria-label="significant: true; required sample size (N), capped at 200: 0  5; count: 2" role="graphics-symbol" aria-roledescription="bar" d="M1,199.33333333333334h9v0.6666666666666572h-9Z" fill="#f58518"></path></g><g class="mark-rule role-mark concat_1_layer_1_marks" role="graphics-object" aria-roledescription="rule mark container"><line aria-label="style: 2; value: 6.95678082972" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(13.91356165943263,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line><line aria-label="style: 1; value: 33.3671314275" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(66.7342628550416,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 0; value: 53.9406174268" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(107.88123485355956,0)" x2="0" y2="200" stroke="black" stroke-dasharray="1,0"></line></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-legend" role="graphics-symbol" aria-roledescription="legend" aria-label="Symbol legend titled 'significant' for fill color with 2 values: false, true"><g transform="translate(500,0)"><path class="background" aria-hidden="true" d="M0,0h56v40h-56Z" pointer-events="none"></path><g><g class="mark-group role-legend-entry"><g transform="translate(0,16)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-group role-scope" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h38v11h-38Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" fill="#4c78a8" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">false</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g><g transform="translate(0,13)"><path class="background" aria-hidden="true" d="M0,0h38v11h-38Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M-5,-5h10v10h-10Z" fill="#f58518" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">true</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-legend-title" pointer-events="none"><text text-anchor="start" transform="translate(0,9)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">significant</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice how nearly the entire distribution of sample sizes for significant tests falls in range of the horizontal axis where power is less than 80% for the ground-truth effect size.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># compare with the median sample size from the unbiased case above</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;N (median estimate, significance-filtered, p&lt;</span><span class="si">{alpha}</span><span class="s2">): </span><span class="si">{x:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">dz_sim</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dz_sim</span><span class="p">[</span><span class="s2">&quot;significant&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;required_n&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;N (ground-truth, </span><span class="si">{power:.0f}</span><span class="s2">% power): </span><span class="si">{x:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">n_for_80</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>N (median estimate, significance-filtered, p&lt;0.05): 20.19
N (ground-truth, 80% power): 33.37
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Indeed, the median sample size for significant experiments is almost the same as the sample size we started with! By only analysing the significant tests, our sample size recommendations end up close to the sample sizes of the studies that went into the calculation, even if those studies were actually underpowered!</p>
<p>To drive this home, let's scale up our simulation a bit to consider other effect and sample sizes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># calculate simulations for all options (careful, this cell is slow)</span>
<span class="n">dz_fullsim</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">this_d</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">):</span>
    <span class="n">dz_fullsim</span><span class="p">[</span><span class="n">this_d</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">this_n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">]:</span>
        <span class="n">dz_fullsim</span><span class="p">[</span><span class="n">this_d</span><span class="p">][</span><span class="n">this_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">(</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">this_d</span><span class="p">,</span> <span class="n">this_n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># the easiest thing to do is to just plot the medians.</span>
<span class="c1"># first we work out what the required_n was for each d</span>
<span class="n">required_n_actual</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">this_d</span><span class="p">:</span> <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
        <span class="n">effect_size</span><span class="o">=</span><span class="n">this_d</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">this_d</span> <span class="ow">in</span> <span class="n">dz_fullsim</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># flatten the nested dicts to a dataframe with median significance-filtered n</span>
<span class="c1"># and actual n in columns</span>
<span class="n">df_fullsim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="n">this_d</span><span class="p">,</span>
            <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">this_n</span><span class="p">,</span>
            <span class="s2">&quot;required_n_median&quot;</span><span class="p">:</span> <span class="n">this_dz</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">this_dz</span><span class="p">[</span><span class="s2">&quot;significant&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;required_n&quot;</span>
            <span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
            <span class="s2">&quot;required_n_actual&quot;</span><span class="p">:</span> <span class="n">required_n_actual</span><span class="p">[</span><span class="n">this_d</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">this_d</span><span class="p">,</span> <span class="n">this_d_dict</span> <span class="ow">in</span> <span class="n">dz_fullsim</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">this_n</span><span class="p">,</span> <span class="n">this_dz</span> <span class="ow">in</span> <span class="n">this_d_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># axis limits: round up to nearest 10 and add pad to avoid second axis clipping</span>
<span class="c1"># labels</span>
<span class="n">max_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">required_n_actual</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">5</span>

<span class="c1"># plot actual vs significance-filtered sample size requirements in points</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_fullsim</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span>
            <span class="s2">&quot;required_n_actual&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;required sample size (N)&quot;</span><span class="p">,</span> <span class="s2">&quot;(actual)&quot;</span><span class="p">],</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n</span><span class="p">]),</span>
        <span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;required_n_median&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;required sample size (N)&quot;</span><span class="p">,</span> <span class="s2">&quot;(significance-filtered median)&quot;</span><span class="p">],</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n</span><span class="p">]),</span>
        <span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;n:O&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="p">)</span>


<span class="c1"># plot a subset of effect sizes as vertical lines</span>
<span class="n">plot_d</span> <span class="o">=</span> <span class="p">[</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">8</span><span class="p">]</span>
<span class="n">dz_d_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="n">plot_d</span><span class="p">,</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">ttest_paired</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
                <span class="n">effect_size</span><span class="o">=</span><span class="n">this_d</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">this_d</span> <span class="ow">in</span> <span class="n">plot_d</span>
        <span class="p">],</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">vlines_d</span><span class="p">,</span> <span class="n">vlabels_d</span> <span class="o">=</span> <span class="n">gridlines</span><span class="p">(</span><span class="n">dz_d_grid</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;.1&quot;</span><span class="p">)</span>

<span class="c1"># unity line</span>
<span class="n">unity</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]}))</span>
    <span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">style_chart</span><span class="p">(</span><span class="n">vlabels_d</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vlines_d</span> <span class="o">+</span> <span class="n">unity</span> <span class="o">+</span> <span class="n">points</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>



<div class="output_svg output_subarea output_execute_result">
<svg class="marks" width="470" height="276" viewBox="0 0 470 276" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clipPath id="clip1"><rect x="0" y="0" width="200" height="200"></rect></clipPath></defs><rect width="470" height="276" fill="white"></rect><g fill="none" stroke-miterlimit="10" transform="translate(202,5)"><g class="mark-group role-frame root" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v0h-200Z"></path><g><g class="mark-group role-scope concat_0_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v20h-200Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'd' for a discrete scale with 1 value: 0"><g transform="translate(200.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,10)" x2="5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="20" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="start" transform="translate(10,13)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">d</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-mark concat_0_marks" role="graphics-object" aria-roledescription="text mark container"><text aria-label="prob: 0.2; value: 198.150824339; d: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(180.13711303583742,13)" font-family="sans-serif" font-size="11px" fill="black">0.2</text><text aria-label="prob: 0.5; value: 33.3671314275; d: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(30.333755843200734,13)" font-family="sans-serif" font-size="11px" fill="black">0.5</text><text aria-label="prob: 0.8; value: 14.3027649935; d: 0" role="graphics-symbol" aria-roledescription="text mark" text-anchor="middle" transform="translate(13.002513630436008,13)" font-family="sans-serif" font-size="11px" fill="black">0.8</text></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-scope concat_1_group" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,21)"><path class="background" aria-hidden="true" d="M0,0h200v200h-200Z" stroke="#ddd" stroke-width="0"></path><g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="X-axis titled 'required sample size (N) (actual)' for a linear scale with values from 0 to 220"><g transform="translate(0.5,200.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(45,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(91,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(136,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(182,0)" x2="0" y2="5" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="start" transform="translate(0,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="middle" transform="translate(45.45454545454545,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">50</text><text text-anchor="middle" transform="translate(90.9090909090909,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="middle" transform="translate(136.36363636363635,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">150</text><text text-anchor="middle" transform="translate(181.8181818181818,15)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,0)" x2="200" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="middle" transform="translate(100,30)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1"><tspan>required sample size (N)</tspan><tspan x="0" dy="13">(actual)</tspan></text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-group role-axis" role="graphics-symbol" aria-roledescription="axis" aria-label="Y-axis titled 'required sample size (N) (significance-filtered median)' for a linear scale with values from 0 to 220"><g transform="translate(0.5,0.5)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-rule role-axis-tick" pointer-events="none"><line transform="translate(0,200)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,155)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,109)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,64)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line><line transform="translate(0,18)" x2="-5" y2="0" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-label" pointer-events="none"><text text-anchor="end" transform="translate(-7,203)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">0</text><text text-anchor="end" transform="translate(-7,157.54545454545453)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">50</text><text text-anchor="end" transform="translate(-7,112.09090909090908)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">100</text><text text-anchor="end" transform="translate(-7,66.63636363636365)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">150</text><text text-anchor="end" transform="translate(-7,21.181818181818187)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">200</text></g><g class="mark-rule role-axis-domain" pointer-events="none"><line transform="translate(0,200)" x2="0" y2="-200" stroke="#888" stroke-width="1" opacity="1"></line></g><g class="mark-text role-axis-title" pointer-events="none"><text text-anchor="end" transform="translate(-42,103)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1"><tspan>required sample size (N)</tspan><tspan x="0" dy="13">(significance-filtered median)</tspan></text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-rule role-mark concat_1_layer_0_marks" role="graphics-object" aria-roledescription="rule mark container"><line aria-label="style: 2; value: 198.150824339" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(180.13711303583742,0)" x2="0" y2="200" stroke="black" stroke-dasharray="2,1"></line><line aria-label="style: 1; value: 33.3671314275" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(30.333755843200734,0)" x2="0" y2="200" stroke="black" stroke-dasharray="4,2"></line><line aria-label="style: 0; value: 14.3027649935" role="graphics-symbol" aria-roledescription="rule mark" transform="translate(13.002513630436008,0)" x2="0" y2="200" stroke="black" stroke-dasharray="1,0"></line></g><g class="mark-line role-mark concat_1_layer_1_marks" clip-path="url(#clip1)" role="graphics-object" aria-roledescription="line mark container"><path aria-label="x: 0; y: 0" role="graphics-symbol" aria-roledescription="line mark" d="M0,200L372.7272727272727,-172.72727272727272" stroke="black" stroke-width="1" opacity="0.5"></path></g><g class="mark-group role-scope concat_1_layer_2_layer_0_pathgroup" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v200h-200Z"></path><g><g class="mark-line role-mark concat_1_layer_2_layer_0_marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="N: 10; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 9.58061784328" role="graphics-symbol" aria-roledescription="line mark" d="M13.002513630436004,191.29034741520056L16.393497040424027,190.823174882446L21.63137705222853,190.42185019880412L30.333755843200755,189.95986637844078L46.3722259814884,189.19469065404834L81.0448786817781,188.98926880889658L180.13711303583742,188.49314602271383" stroke="rgb(168, 206, 229)" stroke-width="2"></path></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v200h-200Z"></path><g><g class="mark-line role-mark concat_1_layer_2_layer_0_marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="N: 20; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 13.2535646724" role="graphics-symbol" aria-roledescription="line mark" d="M13.002513630436004,187.9513048432486L16.393497040424027,185.76001866158109L21.63137705222853,183.4754619195703L30.333755843200755,180.93048548023307L46.3722259814884,178.90677385521002L81.0448786817781,177.30587489927655L180.13711303583742,175.91691245812348" stroke="rgb(116, 178, 215)" stroke-width="2"></path></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v200h-200Z"></path><g><g class="mark-line role-mark concat_1_layer_2_layer_0_marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="N: 40; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 14.1915486766" role="graphics-symbol" aria-roledescription="line mark" d="M13.002513630436004,187.09859211214368L16.393497040424027,183.9051984998997L21.63137705222853,178.84978797377593L30.333755843200755,173.0355987824283L46.3722259814884,165.36065469283267L81.0448786817781,159.34008789163815L180.13711303583742,153.93699333971767" stroke="rgb(69, 146, 198)" stroke-width="2"></path></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h200v200h-200Z"></path><g><g class="mark-line role-mark concat_1_layer_2_layer_0_marks" role="graphics-object" aria-roledescription="line mark container"><path aria-label="N: 80; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 14.1640919933" role="graphics-symbol" aria-roledescription="line mark" d="M13.002513630436004,187.1235527333839L16.393497040424027,183.7152524370437L21.63137705222853,178.78906007503798L30.333755843200755,170.24661504210624L46.3722259814884,156.15270168270925L81.0448786817781,135.98175925014053L180.13711303583742,115.33611469336056" stroke="rgb(32, 111, 178)" stroke-width="2"></path></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-symbol role-mark concat_1_layer_2_layer_1_marks" role="graphics-object" aria-roledescription="symbol mark container"><path aria-label="N: 10; required sample size (N), (actual): 198.150824339; required sample size (N), (significance-filtered median): 12.657539375" role="graphics-symbol" aria-roledescription="point" transform="translate(180.13711303583742,188.49314602271383)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 198.150824339; required sample size (N), (significance-filtered median): 26.4913962961" role="graphics-symbol" aria-roledescription="point" transform="translate(180.13711303583742,175.91691245812348)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 198.150824339; required sample size (N), (significance-filtered median): 50.6693073263" role="graphics-symbol" aria-roledescription="point" transform="translate(180.13711303583742,153.93699333971767)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 198.150824339; required sample size (N), (significance-filtered median): 93.1302738373" role="graphics-symbol" aria-roledescription="point" transform="translate(180.13711303583742,115.33611469336056)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 89.14936655; required sample size (N), (significance-filtered median): 12.1118043102" role="graphics-symbol" aria-roledescription="point" transform="translate(81.0448786817781,188.98926880889658)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 89.14936655; required sample size (N), (significance-filtered median): 24.9635376108" role="graphics-symbol" aria-roledescription="point" transform="translate(81.0448786817781,177.30587489927655)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 89.14936655; required sample size (N), (significance-filtered median): 44.7259033192" role="graphics-symbol" aria-roledescription="point" transform="translate(81.0448786817781,159.34008789163815)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 89.14936655; required sample size (N), (significance-filtered median): 70.4200648248" role="graphics-symbol" aria-roledescription="point" transform="translate(81.0448786817781,135.98175925014053)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 51.0094485796; required sample size (N), (significance-filtered median): 11.8858402805" role="graphics-symbol" aria-roledescription="point" transform="translate(46.3722259814884,189.19469065404834)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 51.0094485796; required sample size (N), (significance-filtered median): 23.2025487593" role="graphics-symbol" aria-roledescription="point" transform="translate(46.3722259814884,178.90677385521002)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 51.0094485796; required sample size (N), (significance-filtered median): 38.1032798379" role="graphics-symbol" aria-roledescription="point" transform="translate(46.3722259814884,165.36065469283267)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 51.0094485796; required sample size (N), (significance-filtered median): 48.232028149" role="graphics-symbol" aria-roledescription="point" transform="translate(46.3722259814884,156.15270168270925)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 33.3671314275; required sample size (N), (significance-filtered median): 11.0441469837" role="graphics-symbol" aria-roledescription="point" transform="translate(30.333755843200755,189.95986637844078)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 33.3671314275; required sample size (N), (significance-filtered median): 20.9764659717" role="graphics-symbol" aria-roledescription="point" transform="translate(30.333755843200755,180.93048548023307)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 33.3671314275; required sample size (N), (significance-filtered median): 29.6608413393" role="graphics-symbol" aria-roledescription="point" transform="translate(30.333755843200755,173.0355987824283)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 33.3671314275; required sample size (N), (significance-filtered median): 32.7287234537" role="graphics-symbol" aria-roledescription="point" transform="translate(30.333755843200755,170.24661504210624)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 23.7945147575; required sample size (N), (significance-filtered median): 10.5359647813" role="graphics-symbol" aria-roledescription="point" transform="translate(21.63137705222853,190.42185019880412)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 23.7945147575; required sample size (N), (significance-filtered median): 18.1769918885" role="graphics-symbol" aria-roledescription="point" transform="translate(21.63137705222853,183.4754619195703)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 23.7945147575; required sample size (N), (significance-filtered median): 23.2652332288" role="graphics-symbol" aria-roledescription="point" transform="translate(21.63137705222853,178.84978797377593)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 23.7945147575; required sample size (N), (significance-filtered median): 23.3320339175" role="graphics-symbol" aria-roledescription="point" transform="translate(21.63137705222853,178.78906007503798)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 18.0328467445; required sample size (N), (significance-filtered median): 10.0945076293" role="graphics-symbol" aria-roledescription="point" transform="translate(16.393497040424027,190.823174882446)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 18.0328467445; required sample size (N), (significance-filtered median): 15.6639794723" role="graphics-symbol" aria-roledescription="point" transform="translate(16.393497040424027,185.76001866158109)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 18.0328467445; required sample size (N), (significance-filtered median): 17.7042816501" role="graphics-symbol" aria-roledescription="point" transform="translate(16.393497040424027,183.9051984998997)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 18.0328467445; required sample size (N), (significance-filtered median): 17.9132223193" role="graphics-symbol" aria-roledescription="point" transform="translate(16.393497040424027,183.7152524370437)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path><path aria-label="N: 10; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 9.58061784328" role="graphics-symbol" aria-roledescription="point" transform="translate(13.002513630436004,191.29034741520056)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(168, 206, 229)" stroke-width="2" opacity="1"></path><path aria-label="N: 20; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 13.2535646724" role="graphics-symbol" aria-roledescription="point" transform="translate(13.002513630436004,187.9513048432486)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(116, 178, 215)" stroke-width="2" opacity="1"></path><path aria-label="N: 40; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 14.1915486766" role="graphics-symbol" aria-roledescription="point" transform="translate(13.002513630436004,187.09859211214368)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(69, 146, 198)" stroke-width="2" opacity="1"></path><path aria-label="N: 80; required sample size (N), (actual): 14.3027649935; required sample size (N), (significance-filtered median): 14.1640919933" role="graphics-symbol" aria-roledescription="point" transform="translate(13.002513630436004,187.1235527333839)" d="M2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,-2.7386127875258306,0A2.7386127875258306,2.7386127875258306,0,1,1,2.7386127875258306,0" fill="rgb(32, 111, 178)" stroke-width="2" opacity="1"></path></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g><g class="mark-group role-legend" role="graphics-symbol" aria-roledescription="legend" aria-label="Symbol legend titled 'N' for fill color and stroke color with 4 values: 10, 20, 40, 80"><g transform="translate(235,0)"><path class="background" aria-hidden="true" d="M0,0h28v77h-28Z" pointer-events="none"></path><g><g class="mark-group role-legend-entry"><g transform="translate(0,16)"><path class="background" aria-hidden="true" d="M0,0h0v0h0Z" pointer-events="none"></path><g><g class="mark-group role-scope" role="graphics-object" aria-roledescription="group mark container"><g transform="translate(0,0)"><path class="background" aria-hidden="true" d="M0,0h28v12.5h-28Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" fill="rgb(168, 206, 229)" stroke="rgb(168, 206, 229)" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">10</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g><g transform="translate(0,16)"><path class="background" aria-hidden="true" d="M0,0h28v12.5h-28Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" fill="rgb(116, 178, 215)" stroke="rgb(116, 178, 215)" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">20</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g><g transform="translate(0,32)"><path class="background" aria-hidden="true" d="M0,0h28v12.5h-28Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" fill="rgb(69, 146, 198)" stroke="rgb(69, 146, 198)" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">40</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g><g transform="translate(0,48)"><path class="background" aria-hidden="true" d="M0,0h28v12.5h-28Z" pointer-events="none" opacity="1"></path><g><g class="mark-symbol role-legend-symbol" pointer-events="none"><path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" fill="rgb(32, 111, 178)" stroke="rgb(32, 111, 178)" stroke-width="1.5" opacity="1"></path></g><g class="mark-text role-legend-label" pointer-events="none"><text text-anchor="start" transform="translate(16,9)" font-family="sans-serif" font-size="10px" fill="#000" opacity="1">80</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g><g class="mark-text role-legend-title" pointer-events="none"><text text-anchor="start" transform="translate(0,9)" font-family="sans-serif" font-size="11px" font-weight="bold" fill="#000" opacity="1">N</text></g></g><path class="foreground" aria-hidden="true" d="" pointer-events="none" display="none"></path></g></g></g><path class="foreground" aria-hidden="true" d="" display="none"></path></g></g></g></svg>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The points show the results for a particular effect size ($d_z$ from 0.2 to 0.8 in 0.1 increments) and sample size ($N$, in colours). The connecting lines are just illustrative (there is probably a way to work out an analytical function for this - let me know if you have a solution).</p>
<p>If all was well, the points would be found along the unity line, indicating that the estimated (vertical axis) and actual (horizontal axis) $N$ are similar. In fact, the estimated $N$ shows a strongly saturating behaviour, with an asymptote just over the original $N$ of the studies that went into the power analysis.</p>
<p>In other words, the sample size of the original studies (in colours) tends to be a better predictor for the result of the sample size calculation than the ground-truth requirements. If a literature is underpowered <em>and</em> suffers from publication bias, naive application of power calculations will tend to perpetuate the problem.</p>
<p>And that's the curse of low statistical power.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Is-it-just-publication-bias-that-we-have-to-worry-about?">Is it just publication bias that we have to worry about?<a class="anchor-link" href="#Is-it-just-publication-bias-that-we-have-to-worry-about?">&#182;</a></h2><p>Hardly! In the above simulations, we could instead think of the distribution over experiments as a distribution <em>within-experiment</em> over fMRI voxels, gene expression values, or any other feature dimension over which we are selecting effects to report.</p>
<p>The situation is often worse within-experiment, because we tend to focus on the peak rather than values over some threshold, and with stronger selection there is more bias. This is why the Poldrack et al. (2017) $d$ plot that we began with cleverly focused on <em>median</em> power over fMRI voxels in independently-selected brain regions.</p>
<p>For instance, if we use the <a href="http://fmripower.org/">best-available tool for fMRI power analysis</a> with default parameters, it reports power for each of the 90 regions in the <a href="https://en.wikipedia.org/wiki/Automated_Anatomical_Labeling">AAL atlas</a>.  If we simply take the peak region in that map and work out sample sizes for that, that estimate is biased, and our new experiment is likely to end up underpowered.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusions">Conclusions<a class="anchor-link" href="#Conclusions">&#182;</a></h2><ul>
<li>It's a bad idea to perform power calculations based on small previous studies because Cohen's $d_z$ is quite variable at typical sample sizes. We have seen that sample size calculations are <em>very</em> sensitive to small differences in estimated effect size, which compounds the issue. This is also the reason why it's a mistake to use 'pilot' studies to estimate effect size.</li>
<li>If there is any selection bias (for instance, you are using an estimate from a non-preregistered publication, or the peak feature over a brain map), your power calculations are likely to end up optimistic in the extreme. With significance filtering you tend to end up paradoxically recommending the same sample size the previous study had, regardless of actual power. With the peak feature approach the situation actually gets more extreme, and you often end up recommending <em>smaller</em> samples than the original study had, regardless of actual power.</li>
<li>Avoid these problems by getting effect size estimates from large consortium studies, where we have the sample size to expect a smaller standard deviation for $d_z$ and sufficiently standardised protocols to minimise bias. This will probably mean powering according to an effect that is rather different from our experiment. But that's better than the alternative.</li>
</ul>

</div>
</div>
</div>
 


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'johancarlin'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2020-06-10-the-curse-of-low-statistical-power';
                        this.page.url = 'https://www.johancarlin.com/the-curse-of-low-statistical-power.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="https://www.johancarlin.com/images/brain.png"/>
        </p>
    <p>
      <strong>About Johan Carlin</strong><br/>
        I work in human neuroimaging research at the University of Cambridge. I specialise in visual neuroscience, statistical methods, computational modelling, and data engineering. I'm a scientist, but I write a lot of code.
    </p>
</div><!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="https://github.com/jooh" target="_blank">code</a>
    </li>
    <li class="list-group-item">
      <a href="https://twitter.com/johancarlin" target="_blank">rants</a>
    </li>
    <li class="list-group-item">
      <a href="https://scholar.google.com/citations?user=hybIdeIAAAAJ" target="_blank">publications</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 Johan Carlin
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.johancarlin.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.johancarlin.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.johancarlin.com/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'johancarlin'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-33066815-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->


</body>
</html>